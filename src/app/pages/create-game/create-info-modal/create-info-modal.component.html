<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button color="dark" (click)="dismissModal('close')">
        <ion-icon name="close"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>
      <ion-icon name="information-circle-outline" color="warning"></ion-icon>
      {{ "Tasktypes.information" | translate }} 
      <!-- Show task No -->
      <span *ngIf="taskNo"> ({{ ("General.task" | translate) + " " + taskNo }}) </span>        
    </ion-title>

    <ion-buttons slot="end">
      <ion-button color="dark" (click)="dismissModal(null)">
        <ion-icon name="save"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <!-- (Vir. Env.): enable teacher to choose a vir. env. -->
  <ion-item *ngIf="isVirtualWorld" class="ion-no-padding">
    <h5>Choose a virtual world</h5>
    &nbsp;&nbsp;

    <select
      [(ngModel)]="virEnvType"
      interface="popover"
      [disabled]="!isSingleMode"
    >
      <option
        *ngFor="let virEnvitem of virEnvTypesList; let i = index"
        [ngValue]="virEnvitem.layerName"
      >
        {{ i + 1 }}: {{ virEnvitem.envName }}
      </option>
    </select>
  </ion-item>
  <!--  -->

  <ion-card color="warning">
    <ion-card-content>
      <ion-icon name="help-circle"></ion-icon>
      {{ "Tasktypes.informationDescription" | translate }}
    </ion-card-content>
  </ion-card>

  <h5>{{ "CreateGame.informationText" | translate }}</h5>
  <ion-textarea
    autoGrow
    placeholder="{{ 'General.pl_optional' | translate }}"
    *ngIf="task"
    [(ngModel)]="task.question.text"
  ></ion-textarea>
  <ion-text color="medium">
    <p>
      {{ "CreateGame.markdownSupported" | translate }}
      <ion-icon
        name="information-circle"
        (click)="utilService.showPopover_i18n($event, 'Popover.markdown')"
      >
      </ion-icon>
    </p>
  </ion-text>

  <ion-item-divider></ion-item-divider>

  <h5>{{ "CreateGame.audioMessage" | translate }}</h5>

  <app-audio-recorder
    [(audioSource)]="task.question.audio"
  ></app-audio-recorder>

  <ion-item-divider></ion-item-divider>

  <!-- set avatar initial position and direction -->
  <ion-item *ngIf="isVirtualWorld" lines="none" class="ion-no-padding">
    <h5>
      {{ "CreateGame.setAvatarPosition" | translate }} üßç‚Äç‚ôÇÔ∏è
      <ion-icon
        name="information-circle"
        (click)="
          utilService.showPopover_i18n($event, 'CreateGame.setAvatarPosition')
        "
      >
      </ion-icon>
    </h5>
    <ion-toggle
      color="danger"
      [(ngModel)]="initialAvatarPositionStatus"
      (ngModelChange)="initialAvatarPosToggleChange()"
    ></ion-toggle>
  </ion-item>
  <div *ngIf="isVirtualWorld && initialAvatarPositionStatus">

    <!-- (Vir. Env.): choose initial floor when other than task floor -->
    <ion-item *ngIf="isVEBuilding" lines="none">
      <ion-label> {{ "CreateTasks.chooseInitialFloor" | translate }} </ion-label>
      <!-- Select -->
      <select
        [(ngModel)]="initialFloor"
        interface="popover"
        [disabled]="!isSingleMode"
      >
        <option *ngIf="initialFloor=='Select floor'" ngvalue="Select floor">
          Select floor
        </option>
        <!-- slice was added to exclude sixth floor -->
        <option
          *ngFor="let floor of virEnvLayers[virEnvType].floors.slice(0, -1); let i = index"
          [ngValue]="floor.tag"
        >
          {{ floor.name }}
        </option>
      </select>
      <br />
    </ion-item>

    <!-- Map view -->
    <app-map
      *ngIf="initialFloor != 'Select floor'"
      featureType="direction"
      [(feature)]="task.question.initialAvatarPosition"
      [isVirtualWorld]="isVirtualWorld"
      [isVRMirrored]="isVRMirrored"
      [virEnvType]="virEnvType"
      [initialFloor]="initialFloor"
    ></app-map>
    <ion-item-divider id="set-avatar-initial-position-divider"></ion-item-divider>
  </div>

  <h5>{{ "CreateGame.photos" | translate }}</h5>

  <app-photo-upload
    theme="warning"
    [(photo)]="task.question.photo"
  ></app-photo-upload>

  <ion-item-divider id="photo-upload-divider"></ion-item-divider>

    <!-- Vir. Env. settings -->
  <div *ngIf="isVirtualWorld && task.settings">
    <!-- section heading -->
    <ion-text>
      <h5>{{ "CreateGame.virEnvSettings" | translate }}</h5>
    </ion-text>
    
    <!-- Avatar speed -->
    <ion-item lines="none" class="item-range">
      <ion-label>
        {{ "CreateGame.avatarSpeed" | translate }}
        <ion-icon
          name="information-circle"
          (click)="showPopover($event, 'Popover.avatarSpeedZero')"
        >
        </ion-icon>
      </ion-label>
      <ion-range
        [(ngModel)]="task.settings.avatarSpeed"
        min="0"
        max="7"
        snaps
        [color]="task.category == 'nav' ? 'primary' : 'secondary'"
        ticks
        pin
      >
        <ion-label slot="start">1m/s</ion-label>
        <ion-icon
          slot="start"
          size="small"
          [color]="task.category == 'nav' ? 'primary' : 'secondary'"
          name="speedometer-outline"
        >
        </ion-icon>
        <ion-icon
          slot="end"
          [color]="task.category == 'nav' ? 'primary' : 'secondary'"
          name="speedometer-outline"
        ></ion-icon>
        <ion-label slot="end">7m/s</ion-label>
      </ion-range>
    </ion-item>

    <!-- Disable avatar rotation -->
    <ion-item lines="none">
      <ion-label> {{ "CreateGame.disableAvatarRotation" | translate }} </ion-label>
      <ion-toggle [(ngModel)]="task.settings.disableAvatarRotation"></ion-toggle>
    </ion-item>

    <!-- show environment settings -->
    <ion-item lines="none">
      <ion-label> {{ "CreateGame.showEnvSettings" | translate }} </ion-label>
      <ion-toggle [(ngModel)]="task.settings.showEnvSettings"></ion-toggle>
    </ion-item>

    <!-- show path visalisation -->
    <ion-item *ngIf="isVEBuilding" lines="none">
      <ion-label> {{ "CreateGame.showEnvPathVisualization" | translate }} </ion-label>
      <ion-toggle [(ngModel)]="task.settings.showPathVisualization"></ion-toggle>
    </ion-item>

    <ion-item lines="none">
      <ion-label
        >Choose map size
      </ion-label>
      <select interface="popover" [(ngModel)]="task.settings.mapSize">
        <option ngValue="1">
          none
        </option>
        <option ngValue="2">
          small
        </option>
        <option ngValue="3">
          medium
        </option>
        <option ngValue="4">
          big
        </option>
        <option ngValue="5">
          full screen
        </option>
      </select>
    </ion-item>

    <ion-item-divider></ion-item-divider>
  </div>

  <!-- Additional settings -->
   <div>
    <h5>{{ "CreateGame.addSettings" | translate }}</h5>
    <ion-item detail lines="none" (click)="presentMapFeaturesModal()">
      <ion-label> {{ "General.mapfeatures" | translate }} </ion-label>
    </ion-item>
   </div>
  
</ion-content>
